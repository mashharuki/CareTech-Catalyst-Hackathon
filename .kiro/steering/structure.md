# Structure Steering

## 全体構造の原則
- モノレポ直下には共通設定を置き、実装は `pkgs/*` に集約する。
- 各パッケージは「1つの主責務」を持ち、責務横断の実装を避ける。
- ディレクトリ構成は機能の境界を表現し、ツール都合の分割を最小化する。
- 共通基盤は `pkgs/shared-infra` に集約し、`backend` と `cli` の重複実装を禁止する。

## パッケージ内構成のパターン
- エントリポイントは `src/index.ts` に置き、外部公開面を明示する。
- ドメインロジックは `src` 配下、検証コードは `src/test` など近接配置で管理する。
- 運用用スクリプトや実行補助は `scripts` / `utils` に分離し、責務を混在させない。

## 依存方向と import ルール
- import は同一パッケージ内の相対パスを基本とし、境界越えは公開 API（パッケージエクスポート）経由で行う。
- `index.ts` の再エクスポートを利用して公開面を安定化し、内部構造変更の影響を局所化する。
- テストは内部詳細に過度依存せず、公開された振る舞いを起点に記述する。
- `backend` と `cli` の共通処理は `shared-infra` 経由でのみ参照し、`backend -> cli` の直接 import を禁止する。
- `shared-infra` はユースケース層（認可判断、業務判定）を持たず、接続/設定/共通型のみを公開する。

## 命名と変更単位
- ファイル名は役割ベース（例: `config`, `api`, `cli`, `witnesses`）で、実装意図を即時に判別可能にする。
- 新規追加は既存カテゴリに沿って配置し、カテゴリ自体を増やすのは繰り返しパターンが確認できた場合に限定する。
- リファクタリング時は「構造整理」と「仕様変更」を分離し、レビュー容易性を維持する。

## Kiro 運用との接続
- 仕様書は `.kiro/specs/` で機能単位に管理し、Steering は横断的な判断原則のみを保持する。
- ルールに準拠した通常実装では Steering を更新しない。
- 構造方針そのものが変わる変更のみ Steering に追記する。
